# 入力設定 - ログ受信エンドポイント
# MrWebDefence-LogServer

# ログ受信エンドポイント（Engine Fluentdから）
# Engine側と合わせる: HTTP、認証はEngineがBearer送信（Authorization: Bearer #{FLUENTD_OUTPUT_AUTH}）
# 必要に応じてリバースプロキシやネットワーク層で認証すること
<source>
  @type http
  @id input_http_logserver
  
  # バインド設定
  port 8888
  bind 0.0.0.0
  
  # パース設定
  <parse>
    @type json
    time_key time
    time_format %Y-%m-%dT%H:%M:%S%z
    keep_time_key true
  </parse>
  
  # レート制限（DoS対策）
  add_http_headers true
  add_remote_addr true
  
  # Body size制限（10MB）
  body_size_limit 10m
  keepalive_timeout 10s
</source>

# モニタリング用エンドポイント
<source>
  @type monitor_agent
  @id input_monitor_agent
  bind 0.0.0.0
  port 24220
</source>

# Prometheusメトリクス
<source>
  @type prometheus
  @id input_prometheus
  bind 0.0.0.0
  port 24231
  metrics_path /metrics
</source>

# ヘルスチェック用エンドポイント
<source>
  @type http
  @id input_http_healthcheck
  port 8889
  bind 127.0.0.1
  
  <parse>
    @type none
  </parse>
</source>
